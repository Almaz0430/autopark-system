(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{926:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return l.createServerReference},findSourceMapURL:function(){return a.findSourceMapURL}});let r=s(1209),a=s(5153),l=s(7197)},3712:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(5155),a=s(2115),l=s(926);let c=(0,l.createServerReference)("0091f0c8c0e3c82fc1a498a0d1df1cf576095ca470",l.callServer,void 0,l.findSourceMapURL,"getAllUsers"),n=(0,l.createServerReference)("60e1634c8f9091c57fb4d465b099dfb1f3eed99ef1",l.callServer,void 0,l.findSourceMapURL,"updateUserRole"),i=(0,l.createServerReference)("604811781a8cbbc8cb327ec2935015c93511638880",l.callServer,void 0,l.findSourceMapURL,"toggleUserStatus");var d=s(9934),o=s(9708),u=s(898);let x=(0,l.createServerReference)("40ed123b545d89ea7193d5de2f12139efccd8a0d8a",l.callServer,void 0,l.findSourceMapURL,"queryGemini");function m(){let[e,t]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),[c,n]=(0,a.useState)(""),[i,d]=(0,a.useState)(!1),o=async t=>{if(t.preventDefault(),!e)return;d(!0),n(""),l("");let s=await x(e);s.success?l(s.text||""):n(s.error||"Произошла неизвестная ошибка"),d(!1)};return(0,r.jsxs)("div",{className:"card bg-white shadow-lg rounded-xl p-6 border border-slate-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)(u.KuA,{className:"text-3xl text-blue-600"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:"Помощник ИИ"}),(0,r.jsx)("p",{className:"text-sm text-slate-500",children:"Задайте вопрос, запросите аналитику или получите помощь по системе."})]})]}),(0,r.jsxs)("form",{onSubmit:o,className:"space-y-4",children:[(0,r.jsx)("textarea",{className:"input w-full h-24 p-3 border-slate-300 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:"Пример: 'Предложи 3 KPI для отслеживания эффективности водителей'",value:e,onChange:e=>t(e.target.value),disabled:i}),(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("button",{type:"submit",className:"flex items-center justify-center gap-2 px-6 py-2 font-semibold text-white bg-blue-600 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-slate-400 disabled:cursor-not-allowed transition-all duration-300 ease-in-out transform hover:scale-[1.02]",disabled:i||!e,children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.hW,{className:"animate-spin"})," Отправка..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Cer,{})," Отправить"]})})})]}),c&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-red-50 text-red-700 border border-red-200 rounded-lg",children:[(0,r.jsx)("p",{className:"font-semibold",children:"Ошибка"}),(0,r.jsx)("p",{children:c})]}),s&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)(u.ZPX,{className:"h-6 w-6 text-yellow-500"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"Ответ от Gemini"})]}),(0,r.jsx)("div",{className:"prose prose-slate max-w-none p-4 bg-slate-50 border border-slate-200 rounded-lg text-sm",children:(0,r.jsx)("p",{children:s})})]})]})}function p(){let{firestore:e}=(0,d.D)(),[t,s]=(0,a.useState)([]),[l,x]=(0,a.useState)([]),[p,f]=(0,a.useState)(!0),[h,b]=(0,a.useState)(""),j=async()=>{f(!0);try{let e=await c();e.success?s(e.users||[]):b(e.error||"Не удалось загрузить пользователей.")}catch(e){b("Произошла критическая ошибка при загрузке пользователей.")}f(!1)};(0,a.useEffect)(()=>{j();let t=(0,o.P)((0,o.rJ)(e,"activity_log"),(0,o.My)("timestamp","desc")),s=(0,o.aQ)(t,e=>{x(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()},[e]);let v=async(e,t)=>{await n(e,t),j()},g=async(e,t)=>{await i(e,!t),j()},y=e=>{let{role:t}=e;switch(t){case"admin":return(0,r.jsx)(u.e7y,{className:"text-red-500",title:"Администратор"});case"dispatcher":return(0,r.jsx)(u.NPF,{className:"text-blue-500",title:"Диспетчер"});case"driver":return(0,r.jsx)(u.x$1,{className:"text-green-500",title:"Водитель"});default:return(0,r.jsx)(u.x$1,{className:"text-gray-400",title:"Нет роли"})}};return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Панель администратора"}),(0,r.jsx)("p",{className:"text-slate-600 mt-2",children:"Управление пользователями и мониторинг системы"})]}),h&&(0,r.jsx)("div",{className:"alert alert-danger",children:h}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)("div",{className:"card p-0 overflow-hidden",children:[(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"Управление пользователями"})}),p?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)(u.hW,{className:"animate-spin text-4xl text-blue-500"})}):(0,r.jsxs)("table",{className:"w-full text-sm text-left text-slate-500",children:[(0,r.jsx)("thead",{className:"text-xs text-slate-700 uppercase bg-slate-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Пользователь"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Роль"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Статус"}),(0,r.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Действия"})]})}),(0,r.jsx)("tbody",{children:t.map(e=>(0,r.jsxs)("tr",{className:"bg-white border-b hover:bg-slate-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 font-medium text-slate-900 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(y,{role:e.role}),e.email]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("select",{value:e.role,onChange:t=>v(e.uid,t.target.value),className:"input py-1 text-xs",children:[(0,r.jsx)("option",{value:"admin",children:"Админ"}),(0,r.jsx)("option",{value:"dispatcher",children:"Диспетчер"}),(0,r.jsx)("option",{value:"driver",children:"Водитель"}),(0,r.jsx)("option",{value:"no-role",children:"Нет роли"})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.disabled?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.disabled?"Заблокирован":"Активен"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("button",{onClick:()=>g(e.uid,e.disabled),className:"text-xl",children:e.disabled?(0,r.jsx)(u.jZj,{className:"text-slate-400"}):(0,r.jsx)(u.RIx,{className:"text-green-500"})})})]},e.uid))})]})]})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"card p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-slate-900 mb-4",children:"Последние действия"}),(0,r.jsx)("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:l.map(e=>{var t;return(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"mt-1 w-2.5 h-2.5 rounded-full ".concat("success"===e.status?"bg-green-500":"bg-blue-500")}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-slate-700",children:e.action}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:[e.user," - ",null==(t=e.timestamp)?void 0:t.toDate().toLocaleString()]})]})]},e.id)})})]})})]}),(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(m,{})})]})}},4585:(e,t,s)=>{"use strict";s.d(t,{BV:()=>o,j2:()=>i,kA:()=>d,yA:()=>n});var r=s(2078),a=s(2553),l=s(9708),c=s(1446);let n=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyBTdkRQUoEWJFTXNP5vGD8_DYZjLcyDpog",authDomain:"autopark-system.firebaseapp.com",projectId:"autopark-system",storageBucket:"autopark-system.firebasestorage.app",messagingSenderId:"375110425620",appId:"1:375110425620:web:0f357c1d44927b0d219b01",measurementId:"G-2VV3093XBH"}),i=(0,a.xI)(n),d=(0,l.aU)(n),o=(0,c.dG)(n)},6724:(e,t,s)=>{"use strict";s.d(t,{k5:()=>o});var r=s(2115),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},l=r.createContext&&r.createContext(a),c=["attr","size","title"];function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach(function(t){var r,a,l;r=e,a=t,l=s[t],(a=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(a))in r?Object.defineProperty(r,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[a]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function o(e){return t=>r.createElement(u,n({attr:d({},e.attr)},t),function e(t){return t&&t.map((t,s)=>r.createElement(t.tag,d({key:s},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var s,{attr:a,size:l,title:i}=e,o=function(e,t){if(null==e)return{};var s,r,a=function(e,t){if(null==e)return{};var s={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;s[r]=e[r]}return s}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)s=l[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}(e,c),u=l||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),r.createElement("svg",n({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,o,{className:s,style:d(d({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==l?r.createElement(l.Consumer,null,e=>t(e)):t(a)}},8657:(e,t,s)=>{Promise.resolve().then(s.bind(s,3712))},9934:(e,t,s)=>{"use strict";s.d(t,{D:()=>i,R:()=>n});var r=s(5155),a=s(2115),l=s(4585);let c=(0,a.createContext)(null),n=e=>{let{children:t}=e;return(0,r.jsx)(c.Provider,{value:{app:l.yA,auth:l.j2,firestore:l.kA,messaging:l.BV},children:t})},i=()=>{let e=(0,a.useContext)(c);if(!e)throw Error("useFirebase must be used within a FirebaseProvider");return e}}},e=>{e.O(0,[135,965,711,345,441,255,358],()=>e(e.s=8657)),_N_E=e.O()}]);