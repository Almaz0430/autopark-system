
# Blueprint: Система Управления Автопарком

## 1. Обзор проекта

Это веб-приложение для управления автопарком, разработанное на Next.js и Firebase. Оно предназначено для координации работы водителей, диспетчеров и администраторов. Приложение обеспечивает отслеживание транспортных средств в реальном времени, управление задачами и системный мониторинг.

### Существующие роли и функции:
- **Аутентификация:** Пользователи могут регистрироваться и входить в систему.
- **Водитель (`/driver`):** Может отслеживать и транслировать свое местоположение в реальном времени.
- **Диспетчер (`/dispatcher`):** Имеет интерфейс с картой для визуального контроля.
- **Администратор (`/admin`):** Имеет панель управления для мониторинга общей активности системы.

## 2. Реализованный дизайн и функции

- **Стек:** Next.js (App Router), TypeScript, Tailwind CSS, Firebase (Auth, Firestore).
- **UI:** Современный, чистый интерфейс с использованием иконок и цветового кодирования для интуитивного восприятия.
- **Отзывчивость:** Компоненты спроектированы для работы на разных устройствах.
- **Панель администратора:** Включает в себя ключевые показатели (KPI), список последних действий и карточки для навигации.
- **Страница водителя:** Отображает статус отслеживания местоположения и важные уведомления.
- **Страница диспетчера:** Центральный элемент - интерактивная карта для мониторинга.

---

## 3. План развития (Текущий)

### **Цель:** Превратить прототип в динамическое приложение с реальными данными.

### **Этап 1: Динамические данные (Приоритет №1)**

1.  **Журнал активности администратора:**
    -   **Проблема:** Список "Последние действия" на странице `/admin` жестко закодирован.
    -   **Решение:**
        1.  Создать в Firestore коллекцию `activity_log`.
        2.  Модифицировать страницу `/admin`, чтобы она в реальном времени считывала и отображала последние 10 записей из `activity_log`.
        3.  Создать серверные функции (Server Actions) для добавления записей в `activity_log` при ключевых действиях пользователя (например, вход в систему).

2.  **Задачи для водителя:**
    -   **Проблема:** Уведомление для водителя на странице `/driver` статично.
    -   **Решение:**
        1.  Создать в Firestore коллекцию `tasks`. Каждая задача будет содержать `driverId`, `title`, `description`, `status` (`pending`, `in_progress`, `completed`).
        2.  Страница `/driver` должна будет считывать и отображать задачи, назначенные текущему водителю.

### **Этап 2: Расширение функционала ролей**

1.  **Диспетчер (Центр управления):**
    -   **Карта:** Отображать местоположение *всех* водителей в реальном времени (данные из коллекции `drivers_locations`).
    -   **Управление задачами:** Создать интерфейс для диспетчера, где он сможет:
        -   Создавать новые задачи (доставки, рейсы).
        -   Назначать задачи конкретным водителям.
        -   Отслеживать статус выполнения задач на карте.

2.  **Водитель (Исполнитель):**
    -   **Список задач:** Отображать не просто уведомление, а полноценный список задач.
    -   **Взаимодействие с задачами:** Позволить водителю менять статус задачи (например, "Принять", "Начать выполнение", "Завершить").

3.  **Администратор (Надзор):**
    -   **Управление пользователями:** Создать интерфейс для просмотра всех пользователей, назначения ролей (через Custom Claims) и блокировки/разблокировки аккаунтов.
    -   **Управление автопарком:** Создать CRUD-интерфейс для добавления/редактирования автомобилей и их привязки к водителям.
    -   **Отчеты:** Превратить статические KPI в реальные графики и отчеты на основе данных из Firestore.

### **Этап 3: Техническое совершенство**

1.  **Безопасность (Firestore Rules):**
    -   Написать строгие правила безопасности для Firestore, чтобы пользователи могли получать доступ только к тем данным, которые разрешены их ролью. (Например, водитель может обновлять только свое местоположение).

2.  **Уведомления (Cloud Messaging):**
    -   Внедрить push-уведомления для мгновенного информирования:
        -   Водителя о новой задаче.
        -   Диспетчера о завершении задачи водителем.

3.  **Пользовательский опыт (UX):**
    -   Добавить индикаторы загрузки (скелетоны, спиннеры) при получении данных.
    -   Реализовать валидацию форм (например, с помощью Zod) для предотвращения ошибок ввода.
